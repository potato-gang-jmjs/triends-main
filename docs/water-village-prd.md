# 물 마을 던전 PRD (Product Requirements Document)

## 📋 목차
- [프로젝트 개요](#프로젝트-개요)
- [스토리라인](#스토리라인)
- [게임플레이 메커니즘](#게임플레이-메커니즘)
- [맵 구조](#맵-구조)
- [퍼즐 설계](#퍼즐-설계)
- [NPC 및 대화](#npc-및-대화)
- [보상 및 진행도](#보상-및-진행도)

## 프로젝트 개요

### 목적
물 마을 던전은 플레이어(우주인)와 인삼이가 협력하여 마을의 물 공급을 복구하는 협동 퍼즐 던전입니다.

### 핵심 컨셉
- **협동 플레이**: P1과 P2의 능력을 조합하여 퍼즐 해결
- **자원 관리**: 물뿌리개의 제한된 물을 전략적으로 사용
- **일시적 변화**: 퍼즐 요소들이 맵 재진입 시 초기화

### 플레이 시간
- 예상 소요 시간: 15-20분
- 퍼즐 개수: 2개 (튜토리얼 1개, 메인 1개)
- 보스전: 1회

## 스토리라인

### 1. 도입부 - 물 마을 진입
**상황 설정**:
- 마을 전체의 물길이 말라있음
- 원래는 "수중 정원 도시"였으나 현재는 갈라진 바닥만 남음
- 마을 중앙에 말라비틀어진 고래뿌리개가 쓰러져 있음

**NPC 상태**:
- 주민들은 갈증으로 거의 말을 못함
- 장로만이 간신히 상황을 설명

### 2. 문제 제시
**고래뿌리개**:
- 평소 마을에 에너지를 받아 세계수에 물을 공급하는 생물
- 현재 완전히 정지된 상태
- 지하 수로의 "흡수 해파리"가 물을 빨아들이고 있음
- 인삼이가 NPC들과 대화하다가, 도와주기로 결정

### 3. 던전 탐험
**지하 수로 구조**:
- 입구: 경비병이 쓰러져 있음 (생존)
- 수로 1: 튜토리얼 구간 (마른 식물 퍼즐)
- 수로 2: 협동 퍼즐 구간 (물 운반, 무게 스위치)
- 보스룸: 흡수 해파리와의 전투

### 4. 클라이맥스
**보스전 이후**:
- 보스 처치 → 물이 다시 흐르기 시작
- 하지만 고래뿌리개는 여전히 정지 상태
- 우주인과 인삼이의 협력으로 무지개 다리를 만들어 고래뿌리개 부활

### 5. 결말
- 고래뿌리개가 물을 뿜으며 마을 복구
- 세계수에 물이 공급되며 우주인의 기억 단편 회상
- 다음 여정으로 이어지는 떡밥 제시

## 게임플레이 메커니즘

### 1. 물뿌리개 시스템 (P1 - 우주인)
**기존 WateringCanSystem 활용**:
- 물 타일에서 1회 충전 가능
- Shift키로 물뿌리기 시작/중지
- 물 소비: 1초당 1단위
- 최대 용량: 10단위
- 인삼이에게 물 공급 → 덩굴 능력 강화

**새로운 활용**:
- 마른 식물에 물 주기 → 임시 발판 생성
- 물 요구 장치 작동

### 2. 덩굴 확장 시스템 (P2 - 인삼이)
**기존 VineExtensionSystem 활용**:
- E키로 덩굴 발사
- 물 근처 또는 물뿌리개 효과 시 사용 가능
- 오브젝트/플레이어 당기기

**새로운 능력 - 무지개 다리**:
- 물 과다 흡수 상태에서 발동
- 공중에 임시 다리 생성 (5초 지속)
- 시각적 효과: 무지개빛 반투명 다리

### 3. 협동 메커니즘
**필수 협력 상황**:
- 우주인이 물을 주어야 인삼이 능력 사용 가능
- 동시 스위치 작동 (양쪽에서 동시 누름)
- 높은 곳의 플레이어를 덩굴로 당기기

## 맵 구조

### 1. 물 마을 (water-village)
**구성 요소**:
- 중앙 광장: 고래뿌리개 위치
- 마을 입구: 주민 NPC 배치
- 장로의 집: 퀘스트 시작 지점
- 수로 입구: 지하로 통하는 포털

**NPC 배치**:
- 장로 (1명): 퀘스트 부여
- 주민 (3-4명): 분위기 조성
- 아이들 (2명): 웅덩이 근처
- 고래뿌리개: 중앙 (오브젝트/NPC)

### 2. 수로 맵 1 (water-channel-1)
**튜토리얼 구간**:
- 크기: 15x10 타일
- 구성:
  - 입구: 경비병 NPC
  - 마른 식물 3개
  - 물 웅덩이 2개
  - 좁은 틈 (덩굴 당기기 필요)

**퍼즐: 마른 식물 되살리기**
- 난이도: 쉬움
- 목적: 기본 메커니즘 학습

### 3. 수로 맵 2 (water-channel-2)
**메인 퍼즐 구간**:
- 크기: 20x15 타일
- 구성:
  - 복잡한 수로 구조
  - 마른 수초 발판 5-6개
  - 무게 스위치 2개
  - 갇힌 아이 구출 이벤트

**퍼즐 A: 물 운반 릴레이**
- 난이도: 중간
- 제한된 물로 경로 만들기
- 덩굴로 중간 연결

**퍼즐 B: 무게 스위치**
- 난이도: 중간
- 동시 작동 필요
- 무지개 다리 활용

### 4. 보스룸 (water-boss)
**흡수 해파리 전투**:
- 크기: 12x12 타일
- 원형 전투 공간
- 주변에 물 웅덩이 배치

## 퍼즐 설계

### 퍼즐 1: 마른 식물 다리 (튜토리얼)
**목표**: 길을 막는 구멍을 건너기

**해법**:
1. 물 웅덩이에서 물 충전
2. 마른 식물에 물 주기
3. 식물이 펼쳐져 다리 생성
4. 다리를 건너 진행

**학습 요소**:
- 물뿌리개 사용법
- 물 충전 메커니즘
- 일시적 변화 개념

### 퍼즐 2: 물 운반 릴레이
**목표**: 넓은 수로를 건너기

**해법**:
1. 첫 번째 수초에 물 주기
2. 인삼이가 덩굴로 중간 연결
3. 다시 물 충전 후 다음 수초 활성화
4. 반복하여 길 완성

**도전 요소**:
- 물 사용 최적화 필요
- 잘못된 순서 시 리트라이

### 퍼즐 3: 동시 스위치
**목표**: 두 개의 스위치를 동시에 눌러 문 열기

**해법**:
1. 우주인이 인삼이에게 물 공급
2. 인삼이가 무지개 다리 생성
3. 각자 스위치 위치로 이동
4. 동시에 스위치 작동

**협동 요소**:
- 타이밍 조율 필요
- 의사소통 중요

## NPC 및 대화

### 1. 물 마을 입구/광장
[장면: 수로가 갈라지고, 광장에 고래뿌리개가 쓰러져 있다.]

- 주민A (목이 바짝 말라 신음): “기침… 크흑… 목이 타들어 간다… 물 한 모금만… 제발…”
- 주민B (두 손으로 입을 축이며): “이 마을은 늘 물로 가득했는데… 이렇게 바닥이 드러나다니… 처음 보는 일이야…”
- 아이1 (마른 웅덩이를 두 손으로 퍼보다가): “안 나와… 아무리 파도 물이 안 나와…”
- 아이2 (눈물을 글썽이며): “고래뿌리개가 다시 일어나면, 물은 돌아올 거야… 그렇지? 그렇다고 해줘…”
- 장로 (지팡이를 짚고 힘겹게 걸어옴): “여행자여… 이 마을을 지켜주던 고래뿌리개가 멈춰버렸다네. 세계수의 숨결이 끊어진 게 분명하지. 마을의 모든 수로는 고래뿌리개와 이어져 있네. 허나 지하 깊은 수로 어딘가에서 괴물이 물을 훔쳐가고 있다네.”
- 우주인: “…괴물?”
- 장로: “그렇다네. 물을 삼키는 해괴한 생물이지. 우리가 내려가려 했지만… 마른 수로는 너무 위험했네.”
- 주민C (분노에 차서): “이대로 두면 모두 죽어버려! 제발… 수로를 살려줘!”
- 인삼이 (옆에서 조용히): “저도 도울게요. 물만 돌아온다면, 저도 힘을 낼 수 있으니까.”
- [메인 퀘스트 시작] → “지하 수로의 원인을 제거하라.”

### 2. 물 마을 수로 1 (튜토리얼 구간)
[장면: 입구 근처, 벽에 기대어 있는 경비병 NPC]

- 경비병 (숨을 몰아쉬며): “윽… 우린 괴물을 막으려다… 거의 전멸했네… 괴물은… 모든 물을 빨아들여서… 아무것도 할 수 없었어…”
- 인삼이 (주위를 둘러보며): “저기 봐, 다리가 돼야 할 잎사귀가 바싹 말라 있어.”
- 우주인 (근처에서 물뿌리개 발견): “…이걸로 물을 퍼와서… 줄 수 있겠네.”
- [플레이어: 물 타일 → 말라붙은 잎사귀에 물 주기 → 다리 생성]
- 경비병 (놀란 듯): “살아났다! 정말… 살아났다! 저 잎사귀가 다시 숨을 쉬고 있어…”
- 인삼이 (해맑게): “좋아! 이제 길을 건널 수 있어. 나도 물을 조금 마시면 힘을 쓸 수 있지.”
- [인삼이가 물을 머금고 덩굴로 우주인을 끌어줌 → 덩굴 당기기 튜토리얼]
- 아이의 목소리 (멀리서 울려 퍼짐, 잔향처럼): “고마워, 언니… 형아… 물이 다시 흐르면… 우리도 웃을 수 있어…”

### 장로 (elder)
**초기 대화**:
```yaml
introduction:
  text: "여행자여... 우리 마을이... 죽어가고 있네..."
  choices:
    - text: "무슨 일이 있었나요?"
      next: "explain_problem"
    - text: "제가 도울 수 있을까요?"
      next: "quest_offer"
```

**퀘스트 완료 후**:
```yaml
quest_complete:
  text: "고래뿌리개가 다시 살아났네! 정말 감사하네!"
  action: "add_stat:reputation:10"
```

### 주민 (villager-water)
**갈증 상태**:
```yaml
thirsty:
  text: "물... 목이... 말라..."
  condition: "flags.water_restored == false"
```

**회복 후**:
```yaml
grateful:
  text: "살았다! 물이 다시 흐른다!"
  condition: "flags.water_restored == true"
```

### 고래뿌리개 (whale-sprout)
**부활 시**:
```yaml
revival:
  text: "뿌우우우~♪ (기쁜 울음소리)"
  action: "set_flag:whale_revived:true"
```

### 경비병 (guard-water)
**수로 입구**:
```yaml
warning:
  text: "조심하게... 안쪽에는... 무서운 것이..."
```


### 진행도 플래그
```typescript
// 주요 진행 플래그
flags.water_village_entered     // 물 마을 진입
flags.water_quest_started       // 퀘스트 시작
flags.channel_1_cleared         // 수로 1 클리어
flags.channel_2_cleared         // 수로 2 클리어
flags.boss_defeated             // 보스 처치
flags.water_restored            // 물 복구
flags.whale_revived            // 고래뿌리개 부활
```

### 세이브 포인트
- 물 마을 입구
- 수로 1 시작 지점
- 수로 2 시작 지점
- 보스전 직전


---

**문서 버전**: 1.0.0  
**작성일**: 2024-01-XX  
**작성자**: Game Design Team  
**검토자**: Technical Lead, QA Lead